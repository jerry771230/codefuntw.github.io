<!doctype html>



  


<html class="theme-next mist use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>






<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="google-site-verification" content="9MjjjAfbFmUf6_Qyjtd54x0imSx4ZtB_BRes0m0A_FM" />













  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="nginx,php71,php-fpm," />





  <link rel="alternate" href="/atom.xml" title="Codefun" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="在 macOX Sierra 透過 brew 指令安裝 php71（帶有 php-fpm）及 nginx。Install NGINX with PHP71 on Mac OS Sierra with Homebrew.">
<meta name="keywords" content="nginx,php71,php-fpm">
<meta property="og:type" content="article">
<meta property="og:title" content="Homebrew 安裝 Nginx、PHP71 筆記">
<meta property="og:url" content="http://codefun.tw/2017/08/27/2017082701-brew-install-nginx-php71-fpm/index.html">
<meta property="og:site_name" content="Codefun">
<meta property="og:description" content="在 macOX Sierra 透過 brew 指令安裝 php71（帶有 php-fpm）及 nginx。Install NGINX with PHP71 on Mac OS Sierra with Homebrew.">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2017-10-23T04:04:10.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Homebrew 安裝 Nginx、PHP71 筆記">
<meta name="twitter:description" content="在 macOX Sierra 透過 brew 指令安裝 php71（帶有 php-fpm）及 nginx。Install NGINX with PHP71 on Mac OS Sierra with Homebrew.">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"hide","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://codefun.tw/2017/08/27/2017082701-brew-install-nginx-php71-fpm/"/>





  <title>Homebrew 安裝 Nginx、PHP71 筆記 | Codefun</title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId      : '',
      xfbml      : true,
      version    : 'v2.6'
    });
  };

  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "//connect.facebook.net/en/sdk.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));
</script>





<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-85444701-2', 'auto');
  ga('send', 'pageview');
</script>












  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Codefun</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://codefun.tw/2017/08/27/2017082701-brew-install-nginx-php71-fpm/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jerry Huang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Codefun">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Homebrew 安裝 Nginx、PHP71 筆記</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-08-27T18:08:52+08:00">
                2017-08-27
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">Post modified</span>
              
              <time title="Post modified" itemprop="dateModified" datetime="2017-10-23T12:04:10+08:00">
                2017-10-23
              </time>
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/lemp/" itemprop="url" rel="index">
                    <span itemprop="name">lemp</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/08/27/2017082701-brew-install-nginx-php71-fpm/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count fb-comments-count" data-href="http://codefun.tw/2017/08/27/2017082701-brew-install-nginx-php71-fpm/" itemprop="commentCount">0</span> comments
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>在 macOX Sierra 透過 <code>brew</code> 指令安裝 <code>php71</code>（帶有 <code>php-fpm</code>）及 <code>nginx</code>。<br>Install NGINX with PHP71 on Mac OS Sierra with Homebrew.</p>
<a id="more"></a>
<h2 id="前言-Prologue"><a href="#前言-Prologue" class="headerlink" title="前言  Prologue"></a>前言  Prologue</h2><p>臨時有需要讓 localhost 透過使用 <a href="https://ngrok.com/" target="_blank" rel="external">ngrok</a> 的對外服務，以測試 webhook 功能，BUT nginx 就在這個時候出問題了。<br>本來以為是用了 <a href="https://laravel.com/docs/master/valet" target="_blank" rel="external">Laravel Valet</a> 的關係，但即使是停用 Valet，修改 hosts 或重建 nginx.conf 都於事無補，只好從安裝 PHP 到 Nginx 重新做起。</p>
<h2 id="環境-Environment"><a href="#環境-Environment" class="headerlink" title="環境  Environment"></a>環境  Environment</h2><ul>
<li>macOS Sierra： 10.12.5</li>
<li>homebrew： 1.3.1</li>
</ul>
<h2 id="Install-Commandline-Tools"><a href="#Install-Commandline-Tools" class="headerlink" title="Install Commandline Tools"></a>Install Commandline Tools</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ xcode-select —install</div></pre></td></tr></table></figure>
<h2 id="Install-Homebrew"><a href="#Install-Homebrew" class="headerlink" title="Install Homebrew"></a>Install Homebrew</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot;</div></pre></td></tr></table></figure>
<h3 id="Check-Installation"><a href="#Check-Installation" class="headerlink" title="Check Installation"></a>Check Installation</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ brew doctor</div></pre></td></tr></table></figure>
<h3 id="Update-Brew-and-Packages"><a href="#Update-Brew-and-Packages" class="headerlink" title="Update Brew and Packages"></a>Update Brew and Packages</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ brew update &amp;&amp; brew upgrade</div></pre></td></tr></table></figure>
<h3 id="Install-brew-services"><a href="#Install-brew-services" class="headerlink" title="Install brew services"></a>Install brew services</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ brew tap homebrew/services</div></pre></td></tr></table></figure>
<h2 id="安裝-DNSMasq"><a href="#安裝-DNSMasq" class="headerlink" title="安裝 DNSMasq"></a>安裝 DNSMasq</h2><p>DNSMasq is used to resolve all domains that end with .dev to 127.0.0.1.<br>DNSMasq 將 .env 結尾的網址對應到 127.0.0.1，就不需要再修改 <code>/etc/hosts</code> 檔案</p>
<h3 id="安裝-Install"><a href="#安裝-Install" class="headerlink" title="安裝  Install"></a>安裝  Install</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ brew install dnsmasq</div></pre></td></tr></table></figure>
<h3 id="配置-Configure"><a href="#配置-Configure" class="headerlink" title="配置  Configure"></a>配置  Configure</h3><p>檔案 <code>/usr/local/etc/dnsmasq.conf</code> 內容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">address=/.dev/127.0.0.1</div><div class="line">listen-address=127.0.0.1</div></pre></td></tr></table></figure></p>
<p>檔案 <code>/etc/resolver/dev</code> 內容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nameserver 127.0.0.1</div></pre></td></tr></table></figure></p>
<h3 id="start、stop、restart-DNSMasq"><a href="#start、stop、restart-DNSMasq" class="headerlink" title="start、stop、restart DNSMasq"></a><code>start</code>、<code>stop</code>、<code>restart</code> DNSMasq</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ sudo brew services start dnsmasq</div><div class="line">$ sudo brew services stop dnsmasq</div><div class="line">$ sudo brew services restart dnsmasq</div></pre></td></tr></table></figure>
<h3 id="測試-Testing"><a href="#測試-Testing" class="headerlink" title="測試  Testing"></a>測試  Testing</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">$ dig testing.dev @127.0.0.1</div><div class="line">dig testing.dev @127.0.0.1</div><div class="line"></div><div class="line">; &lt;&lt;&gt;&gt; DiG 9.8.3-P1 &lt;&lt;&gt;&gt; testing.dev @127.0.0.1</div><div class="line">;; global options: +cmd</div><div class="line">;; Got answer:</div><div class="line">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 21966</div><div class="line">;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0</div><div class="line"></div><div class="line">;; QUESTION SECTION:</div><div class="line">;testing.dev.           IN  A</div><div class="line"></div><div class="line">;; ANSWER SECTION:</div><div class="line">testing.dev.        0   IN  A   127.0.0.1</div><div class="line"></div><div class="line">;; Query time: 1 msec</div><div class="line">;; SERVER: 127.0.0.1#53(127.0.0.1)</div><div class="line">;; WHEN: Sun Aug 27 22:39:50 2017</div><div class="line">;; MSG SIZE  rcvd: 45</div></pre></td></tr></table></figure>
<h2 id="安裝-PHP-FPM"><a href="#安裝-PHP-FPM" class="headerlink" title="安裝 PHP-FPM"></a>安裝 PHP-FPM</h2><h3 id="Install-php71"><a href="#Install-php71" class="headerlink" title="Install php71"></a>Install php71</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line">$ brew tap homebrew/dupes &amp;&amp; \</div><div class="line">$ brew tap homebrew/php</div><div class="line"></div><div class="line">$ brew install php71</div><div class="line">==&gt; Installing php71 from homebrew/php</div><div class="line">==&gt; Downloading https://homebrew.bintray.com/bottles-php/php71-7.1.1_12.sierra.bottle.tar.gz</div><div class="line">######################################################################## 100.0%</div><div class="line">==&gt; Pouring php71-7.1.1_12.sierra.bottle.tar.gz</div><div class="line">==&gt; Caveats</div><div class="line">The php.ini file can be found in:</div><div class="line">    /usr/local/etc/php/7.1/php.ini</div><div class="line"></div><div class="line">✩✩✩✩ Extensions ✩✩✩✩</div><div class="line"></div><div class="line">If you are having issues with custom extension compiling, ensure that</div><div class="line">you are using the brew version, by placing /usr/local/bin before /usr/sbin in your PATH:</div><div class="line"></div><div class="line">      PATH=&quot;/usr/local/bin:$PATH&quot;</div><div class="line"></div><div class="line">PHP71 Extensions will always be compiled against this PHP. Please install them</div><div class="line">using --without-homebrew-php to enable compiling against system PHP.</div><div class="line"></div><div class="line">✩✩✩✩ PHP CLI ✩✩✩✩</div><div class="line"></div><div class="line">If you wish to swap the PHP you use on the command line, you should add the following to ~/.bashrc,</div><div class="line">~/.zshrc, ~/.profile or your shell&apos;s equivalent configuration file:</div><div class="line"></div><div class="line">      export PATH=&quot;$(brew --prefix homebrew/php/php71)/bin:$PATH&quot;</div><div class="line"></div><div class="line">✩✩✩✩ FPM ✩✩✩✩</div><div class="line"></div><div class="line">To launch php-fpm on startup:</div><div class="line">    mkdir -p ~/Library/LaunchAgents</div><div class="line">    cp /usr/local/opt/php71/homebrew.mxcl.php71.plist ~/Library/LaunchAgents/</div><div class="line">    launchctl load -w ~/Library/LaunchAgents/homebrew.mxcl.php71.plist</div><div class="line"></div><div class="line">The control script is located at /usr/local/opt/php71/sbin/php71-fpm</div><div class="line"></div><div class="line">OS X 10.8 and newer come with php-fpm pre-installed, to ensure you are using the brew version you need to make sure /usr/local/sbin is before /usr/sbin in your PATH:</div><div class="line"></div><div class="line">  PATH=&quot;/usr/local/sbin:$PATH&quot;</div><div class="line"></div><div class="line">You may also need to edit the plist to use the correct &quot;UserName&quot;.</div><div class="line"></div><div class="line">Please note that the plist was called &apos;homebrew-php.josegonzalez.php71.plist&apos; in old versions</div><div class="line">of this formula.</div><div class="line"></div><div class="line">With the release of macOS Sierra the Apache module is now not built by default. If you want to build it on your system</div><div class="line">you have to install php with the --with-httpd24 option. See  brew options php71  for more details.</div><div class="line"></div><div class="line">To have launchd start homebrew/php/php71 now and restart at login:</div><div class="line">  brew services start homebrew/php/php71</div><div class="line">==&gt; Summary</div><div class="line">🍺  /usr/local/Cellar/php71/7.1.1_12: 344 files, 39.7M</div></pre></td></tr></table></figure>
<h3 id="配置-Configure-1"><a href="#配置-Configure-1" class="headerlink" title="配置  Configure"></a>配置  Configure</h3><p>編輯檔案 <code>/usr/local/etc/php/7.1/php-fpm.d/www.conf</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">user = YOUR_USERNAME</div><div class="line">group = staff</div></pre></td></tr></table></figure></p>
<h3 id="測試-Testing-1"><a href="#測試-Testing-1" class="headerlink" title="測試  Testing"></a>測試  Testing</h3><p>啟動 php-fpm<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo brew services start php71</div></pre></td></tr></table></figure></p>
<p>Show running processes<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">lsof -Pni4 | grep LISTEN | grep php</div></pre></td></tr></table></figure></p>
<h2 id="安裝-NGINX"><a href="#安裝-NGINX" class="headerlink" title="安裝 NGINX"></a>安裝 NGINX</h2><h3 id="Install-NGINX"><a href="#Install-NGINX" class="headerlink" title="Install NGINX"></a>Install NGINX</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">$ brew tap homebrew/nginx</div><div class="line"></div><div class="line">$ brew install nginx</div><div class="line">==&gt; Downloading https://homebrew.bintray.com/bottles/nginx-1.12.1.sierra.bottle.tar.gz</div><div class="line">######################################################################## 100.0%</div><div class="line">==&gt; Pouring nginx-1.12.1.sierra.bottle.tar.gz</div><div class="line">==&gt; Caveats</div><div class="line">Docroot is: /usr/local/var/www</div><div class="line"></div><div class="line">The default port has been set in /usr/local/etc/nginx/nginx.conf to 8080 so that</div><div class="line">nginx can run without sudo.</div><div class="line"></div><div class="line">nginx will load all files in /usr/local/etc/nginx/servers/.</div><div class="line"></div><div class="line">To have launchd start nginx now and restart at login:</div><div class="line">  brew services start nginx</div><div class="line">Or, if you don&apos;t want/need a background service you can just run:</div><div class="line">  nginx</div><div class="line">==&gt; Summary</div><div class="line">🍺  /usr/local/Cellar/nginx/1.12.1: 23 files, 1MB</div></pre></td></tr></table></figure>
<h3 id="安裝測試-Testing"><a href="#安裝測試-Testing" class="headerlink" title="安裝測試  Testing"></a>安裝測試  Testing</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">## Start Nginx</div><div class="line">$ sudo brew services start nginx</div><div class="line"></div><div class="line">## Check if Nginx is running on default port</div><div class="line">$ curl -IL http://127.0.0.1:8080</div><div class="line">curl -IL http://127.0.0.1:8080</div><div class="line">HTTP/1.1 200 OK</div><div class="line">Server: nginx/1.12.1</div><div class="line">Date: Sun, 27 Aug 2017 14:59:30 GMT</div><div class="line">Content-Type: text/html</div><div class="line">Content-Length: 274</div><div class="line">Last-Modified: Sat, 26 Aug 2017 14:05:36 GMT</div><div class="line">Connection: keep-alive</div><div class="line">ETag: &quot;59a18030-112&quot;</div><div class="line">Accept-Ranges: bytes</div></pre></td></tr></table></figure>
<h3 id="Stop-Nginx"><a href="#Stop-Nginx" class="headerlink" title="Stop Nginx"></a>Stop Nginx</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo brew services stop nginx</div></pre></td></tr></table></figure>
<h3 id="配置-Configure-2"><a href="#配置-Configure-2" class="headerlink" title="配置  Configure"></a>配置  Configure</h3><h4 id="建立目錄-Create-directories"><a href="#建立目錄-Create-directories" class="headerlink" title="建立目錄  Create directories"></a>建立目錄  Create directories</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ mkdir -p /usr/local/etc/nginx/sites-available &amp;&amp; \</div><div class="line">$ mkdir -p /usr/local/etc/nginx/sites-enabled &amp;&amp; \</div><div class="line">$ mkdir -p /usr/local/etc/nginx/conf.d &amp;&amp; \</div><div class="line">$ mkdir -p /usr/local/etc/nginx/ssl</div></pre></td></tr></table></figure>
<h4 id="配置檔案-nginx-conf"><a href="#配置檔案-nginx-conf" class="headerlink" title="配置檔案 nginx.conf"></a>配置檔案 nginx.conf</h4><p>刪除預設檔案<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ rm /usr/local/etc/nginx/nginx.conf</div></pre></td></tr></table></figure></p>
<p>建立新檔 <code>$ vim /usr/local/etc/nginx/nginx.conf</code> 內容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">worker_processes  1;</div><div class="line"></div><div class="line">error_log  /var/log/nginx/error.log;</div><div class="line"></div><div class="line">events &#123;</div><div class="line">    worker_connections  1024;</div><div class="line">&#125;</div><div class="line"></div><div class="line">http &#123;</div><div class="line">    include             mime.types;</div><div class="line">    default_type        application/octet-stream;</div><div class="line"></div><div class="line">    log_format  main  &apos;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &apos;</div><div class="line">                      &apos;$status $body_bytes_sent &quot;$http_referer&quot; &apos;</div><div class="line">                      &apos;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&apos;;</div><div class="line"></div><div class="line">    access_log  /var/log/nginx/access.log  main;</div><div class="line"></div><div class="line">    #sendfile            on;</div><div class="line">    sendfile            off;</div><div class="line"></div><div class="line">    #keepalive_timeout   65;</div><div class="line">    keepalive_timeout   1;</div><div class="line"></div><div class="line">    index index.html index.php;</div><div class="line"></div><div class="line">    include /usr/local/etc/nginx/sites-enabled/*;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="啟動並測試-Nginx-Start-and-Test-Nginx"><a href="#啟動並測試-Nginx-Start-and-Test-Nginx" class="headerlink" title="啟動並測試 Nginx  Start and Test Nginx"></a>啟動並測試 Nginx  Start and Test Nginx</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">## Start Nginx</div><div class="line">$ sudo brew services start nginx</div><div class="line"></div><div class="line">## Check if Nginx is running on default port</div><div class="line">$ curl -IL http://localhost</div><div class="line">curl -IL http://localhost</div><div class="line">HTTP/1.1 200 OK</div><div class="line">Server: nginx/1.12.1</div><div class="line">Date: Sun, 27 Aug 2017 15:12:35 GMT</div><div class="line">Content-Type: text/html</div><div class="line">Content-Length: 274</div><div class="line">Last-Modified: Sat, 26 Aug 2017 14:05:36 GMT</div><div class="line">Connection: keep-alive</div><div class="line">ETag: &quot;59a18030-112&quot;</div><div class="line">Accept-Ranges: bytes</div></pre></td></tr></table></figure>
<h2 id="設定-SSL-Setup-SSL"><a href="#設定-SSL-Setup-SSL" class="headerlink" title="設定 SSL  Setup SSL"></a>設定 SSL  Setup SSL</h2><p>Generate 4096 bit RSA keys and the self-sign the certificates<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ openssl req -new -newkey rsa:4096 -days 365 -nodes -x509 -subj &quot;/C=US/ST=State/L=Town/O=Office/CN=localhost&quot; -keyout /usr/local/etc/nginx/ssl/localhost.key -out /usr/local/etc/nginx/ssl/localhost.crt</div></pre></td></tr></table></figure></p>
<p>RSA keys 存放在資料夾 <code>/usr/local/etc/nginx/ssl</code></p>
<h2 id="建立-Virtual-Hosts-網站檔案"><a href="#建立-Virtual-Hosts-網站檔案" class="headerlink" title="建立 Virtual Hosts 網站檔案"></a>建立 Virtual Hosts 網站檔案</h2><p>檔案 <code>/usr/local/etc/nginx/sites-available/default</code> 內容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">server &#123;</div><div class="line">    listen       80;</div><div class="line">    server_name  localhost;</div><div class="line">    root       /YOUR/DOCUMENT/ROOT;</div><div class="line"></div><div class="line">    access_log  /var/log/default.access.log  main;</div><div class="line">    error_log  /var/log/nginx/default.error.log  debug;</div><div class="line"></div><div class="line">    location / &#123;</div><div class="line">        include   /usr/local/etc/nginx/conf.d/php-fpm;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    location = /info &#123;</div><div class="line">        allow   127.0.0.1;</div><div class="line">        deny    all;</div><div class="line">        rewrite (.*) /.info.php;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    error_page  404     /404.html;</div><div class="line">    error_page  403     /403.html;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>檔案 <code>/usr/local/etc/nginx/sites-available/default-ssl</code> 內容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">server &#123;</div><div class="line">    listen       443;</div><div class="line">    server_name  localhost;</div><div class="line">    root       /YOUR/DOCUMENT/ROOT;</div><div class="line"></div><div class="line">    access_log  /var/log/nginx/default-ssl.access.log  main;</div><div class="line">    error_log  /var/log/nginx/default-ssl.error.log  debug;</div><div class="line"></div><div class="line">    ssl                  on;</div><div class="line">    ssl_certificate      ssl/localhost.crt;</div><div class="line">    ssl_certificate_key  ssl/localhost.key;</div><div class="line"></div><div class="line">    ssl_session_timeout  5m;</div><div class="line"></div><div class="line">    ssl_protocols  SSLv2 SSLv3 TLSv1;</div><div class="line">    ssl_ciphers  HIGH:!aNULL:!MD5;</div><div class="line">    ssl_prefer_server_ciphers   on;</div><div class="line"></div><div class="line">    location / &#123;</div><div class="line">        include   /usr/local/etc/nginx/conf.d/php-fpm;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    location = /info &#123;</div><div class="line">        allow   127.0.0.1;</div><div class="line">        deny    all;</div><div class="line">        rewrite (.*) /.info.php;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    error_page  404     /404.html;</div><div class="line">    error_page  403     /403.html;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>檔案 <code>/usr/local/etc/nginx/conf.d/php-fpm</code> 內容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">location ~ \.php$ &#123;</div><div class="line">    try_files      $uri = 404;</div><div class="line">    fastcgi_pass   127.0.0.1:9000;</div><div class="line">    fastcgi_index  index.php;</div><div class="line">    fastcgi_param  SCRIPT_FILENAME $document_root$fastcgi_script_name;</div><div class="line">    include        fastcgi_params;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="Activate-Virtual-Hosts"><a href="#Activate-Virtual-Hosts" class="headerlink" title="Activate Virtual Hosts"></a>Activate Virtual Hosts</h3><p>在 <code>sites-enabled</code> 目錄下建立 Symbolic link。將要 enable 的 virtal host 指向 <code>sites-available</code> 目錄內的 virtal host config file。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ ln -sfv /usr/local/etc/nginx/sites-available/default /usr/local/etc/nginx/sites-enabled/default</div><div class="line">$ ln -sfv /usr/local/etc/nginx/sites-available/default-ssl /usr/local/etc/nginx/sites-enabled/default-ssl</div></pre></td></tr></table></figure></p>
<h3 id="測試-Testing-2"><a href="#測試-Testing-2" class="headerlink" title="測試 Testing"></a>測試 Testing</h3><p>建立 <code>/YOUR/DOCUMENT/ROOT/info.php</code> 內容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;?php</div><div class="line">phpinfo();</div><div class="line">?&gt;</div></pre></td></tr></table></figure></p>
<p>重新啟動 Nginx 並測試<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">$ sudo brew services restart nginx</div><div class="line"></div><div class="line">$ curl -IL http://localhost/info.php</div><div class="line">curl -IL http://localhost/info.php</div><div class="line">HTTP/1.1 200 OK</div><div class="line">Server: nginx/1.12.1</div><div class="line">Date: Sun, 27 Aug 2017 15:24:46 GMT</div><div class="line">Content-Type: text/html; charset=UTF-8</div><div class="line">Connection: keep-alive</div><div class="line">X-Powered-By: PHP/7.1.8</div></pre></td></tr></table></figure></p>
<h2 id="安裝其他-Libraries"><a href="#安裝其他-Libraries" class="headerlink" title="安裝其他 Libraries"></a>安裝其他 Libraries</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ brew install php71-mcrypt php71-imagick</div></pre></td></tr></table></figure>
<p><code>brew info</code> 查看 PHP 及其相關 Libraries 的資訊<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div></pre></td><td class="code"><pre><div class="line">$ brew info php71</div><div class="line">homebrew/php/php71: stable 7.1.8 (bottled), HEAD</div><div class="line">PHP Version 7.1</div><div class="line">https://php.net</div><div class="line">Conflicts with:</div><div class="line">  php53 (because different php versions install the same binaries.)</div><div class="line">  php54 (because different php versions install the same binaries.)</div><div class="line">  php55 (because different php versions install the same binaries.)</div><div class="line">  php56 (because different php versions install the same binaries.)</div><div class="line">  php70 (because different php versions install the same binaries.)</div><div class="line">  php72 (because different php versions install the same binaries.)</div><div class="line">/usr/local/Cellar/php71/7.1.8_20 (349 files, 39.5MB) *</div><div class="line">  Poured from bottle on 2017-08-26 at 16:34:27</div><div class="line">From: https://github.com/Homebrew/homebrew-php/blob/master/Formula/php71.rb</div><div class="line">==&gt; Dependencies</div><div class="line">Required: freetype ✔, gettext ✔, icu4c ✔, jpeg ✔, libpng ✔, libxml2 ✔, unixodbc ✔, readline ✔, openssl ✔</div><div class="line">Optional: enchant ✘, gmp ✘, webp ✘, homebrew/apache/httpd24 ✔, homebrew/apache/httpd22 ✘</div><div class="line">==&gt; Requirements</div><div class="line">Optional: postgresql ✘</div><div class="line">==&gt; Options</div><div class="line">--with-cgi</div><div class="line">	Enable building of the CGI executable (implies --without-fpm)</div><div class="line">--with-debug</div><div class="line">	Compile with debugging symbols</div><div class="line">--with-enchant</div><div class="line">	Build with enchant support</div><div class="line">--with-gmp</div><div class="line">	Build with gmp support</div><div class="line">--with-homebrew-curl</div><div class="line">	Include Curl support via Homebrew</div><div class="line">--with-homebrew-libressl</div><div class="line">	Include LibreSSL instead of OpenSSL via Homebrew</div><div class="line">--with-homebrew-libxml2</div><div class="line">	Include Libxml2 support via Homebrew</div><div class="line">--with-homebrew-libxslt</div><div class="line">	Include LibXSLT support via Homebrew</div><div class="line">--with-httpd22</div><div class="line">	Enable building of shared Apache 2.2 Handler module</div><div class="line">--with-httpd24</div><div class="line">	Enable building of shared Apache 2.4 Handler module</div><div class="line">--with-imap</div><div class="line">	Include IMAP extension</div><div class="line">--with-libmysql</div><div class="line">	Include (old-style) libmysql support instead of mysqlnd</div><div class="line">--with-mssql</div><div class="line">	Include MSSQL-DB support</div><div class="line">--with-pdo-oci</div><div class="line">	Include Oracle databases (requries ORACLE_HOME be set)</div><div class="line">--with-pear</div><div class="line">	Build with PEAR</div><div class="line">--with-phpdbg</div><div class="line">	Enable building of the phpdbg SAPI executable</div><div class="line">--with-postgresql</div><div class="line">	Build with postgresql support</div><div class="line">--with-thread-safety</div><div class="line">	Build with thread safety</div><div class="line">--with-webp</div><div class="line">	Build with webp support</div><div class="line">--without-bz2</div><div class="line">	Build without bz2 support</div><div class="line">--without-fpm</div><div class="line">	Disable building of the fpm SAPI executable</div><div class="line">--without-ldap</div><div class="line">	Build without LDAP support</div><div class="line">--without-legacy-mysql</div><div class="line">	Do not include the deprecated mysql_ functions</div><div class="line">--without-mysql</div><div class="line">	Remove MySQL/MariaDB support</div><div class="line">--without-pcntl</div><div class="line">	Build without Process Control support</div><div class="line">--without-unixodbc</div><div class="line">	Build without unixODBC support</div><div class="line">--HEAD</div><div class="line">	Install HEAD version</div><div class="line">==&gt; Caveats</div><div class="line">The php.ini file can be found in:</div><div class="line">    /usr/local/etc/php/7.1/php.ini</div><div class="line"></div><div class="line">✩✩✩✩ Extensions ✩✩✩✩</div><div class="line"></div><div class="line">If you are having issues with custom extension compiling, ensure that you are using the brew version, by placing /usr/local/bin before /usr/sbin in your PATH:</div><div class="line"></div><div class="line">      PATH=&quot;/usr/local/bin:$PATH&quot;</div><div class="line"></div><div class="line">PHP71 Extensions will always be compiled against this PHP. Please install them using --without-homebrew-php to enable compiling against system PHP.</div><div class="line"></div><div class="line">✩✩✩✩ PHP CLI ✩✩✩✩</div><div class="line"></div><div class="line">If you wish to swap the PHP you use on the command line, you should add the following to ~/.bashrc, ~/.zshrc, ~/.profile or your shell&apos;s equivalent configuration file:</div><div class="line">  export PATH=&quot;$(brew --prefix homebrew/php/php71)/bin:$PATH&quot;</div><div class="line"></div><div class="line">✩✩✩✩ FPM ✩✩✩✩</div><div class="line"></div><div class="line">To launch php-fpm on startup:</div><div class="line">    mkdir -p ~/Library/LaunchAgents</div><div class="line">    cp /usr/local/opt/php71/homebrew.mxcl.php71.plist ~/Library/LaunchAgents/</div><div class="line">    launchctl load -w ~/Library/LaunchAgents/homebrew.mxcl.php71.plist</div><div class="line"></div><div class="line">The control script is located at /usr/local/opt/php71/sbin/php71-fpm</div><div class="line"></div><div class="line">OS X 10.8 and newer come with php-fpm pre-installed, to ensure you are using the brew version you need to make sure /usr/local/sbin is before /usr/sbin in your PATH:</div><div class="line"></div><div class="line">  PATH=&quot;/usr/local/sbin:$PATH&quot;</div><div class="line"></div><div class="line">You may also need to edit the plist to use the correct &quot;UserName&quot;.</div><div class="line"></div><div class="line">Please note that the plist was called &apos;homebrew-php.josegonzalez.php71.plist&apos; in old versions of this formula.</div><div class="line"></div><div class="line">With the release of macOS Sierra the Apache module is now not built by default. If you want to build it on your system you have to install php with the --with-httpd24 option. See  brew options php71 for more details.</div><div class="line"></div><div class="line">To have launchd start homebrew/php/php71 now and restart at login:</div><div class="line">  brew services start homebrew/php/php71</div></pre></td></tr></table></figure></p>
<hr>
<h2 id="後記-Epilogue"><a href="#後記-Epilogue" class="headerlink" title="後記 Epilogue"></a>後記 Epilogue</h2><p>如果 <code>$ curl -IL http://127.0.0.1:8080</code> 出現 <code>curl: (7) Failed to connect to 127.0.0.1 port 8080: Connection refused</code>，請記得檢查</p>
<ol>
<li>php-fpm 是不是啟動</li>
<li>nginx 是否有 restart</li>
<li><code>/usr/loca/etc/php/7.1/php-fpm.d/www.conf</code> 內 <code>user</code> 及 <code>group</code> 是否正確設定</li>
<li><code>/usr/local/etc/nginx/conf.d/php-fpm</code> 檔案是否建立</li>
</ol>
<hr>
<h2 id="參考資料-References"><a href="#參考資料-References" class="headerlink" title="參考資料  References"></a>參考資料  References</h2><ul>
<li><a href="https://gist.github.com/dtomasi/ab76d14338db82ec24a1fc137caff75b" target="_blank" rel="external">Install NGINX with PHP7-FPM on Mac OS X with Homebrew</a></li>
<li><a href="https://gist.github.com/pixeline/51c43c787f51b018d484597f30be3d2b" target="_blank" rel="external">pixeline/php_upgrade_to_71.sh</a></li>
</ul>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/nginx/" rel="tag"># nginx</a>
          
            <a href="/tags/php71/" rel="tag"># php71</a>
          
            <a href="/tags/php-fpm/" rel="tag"># php-fpm</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/08/18/2017081804-wget-download-web-pages/" rel="next" title="使用 wget 砍站">
                <i class="fa fa-chevron-left"></i> 使用 wget 砍站
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/08/29/2017082901-editorconfig-settings/" rel="prev" title="使用 EditorConfig 統一專案的 Coding Style">
                使用 EditorConfig 統一專案的 Coding Style <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
        <!-- Go to www.addthis.com/dashboard to customize your tools -->
<div class="addthis_inline_share_toolbox">
  <script type = "text/javascript" src = "//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-59202e2d25ce1195" async = "async" ></script>
</div>

      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="fb-comments"
           data-href="http://codefun.tw/2017/08/27/2017082701-brew-install-nginx-php71-fpm/"
           data-numposts="10"
           data-width="100%"
           data-colorscheme="light">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/avatar.png"
               alt="Jerry Huang" />
          <p class="site-author-name" itemprop="name">Jerry Huang</p>
           
              <p class="site-description motion-element" itemprop="description">知識不是力量 分享知識才是力量</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">13</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">11</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">24</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://www.linkedin.com/in/jerry771230" target="_blank" title="LinkedIn">
                  
                    <i class="fa fa-fw fa-linkedin"></i>
                  
                  LinkedIn
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#前言-Prologue"><span class="nav-text">前言  Prologue</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#環境-Environment"><span class="nav-text">環境  Environment</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Install-Commandline-Tools"><span class="nav-text">Install Commandline Tools</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Install-Homebrew"><span class="nav-text">Install Homebrew</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Check-Installation"><span class="nav-text">Check Installation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Update-Brew-and-Packages"><span class="nav-text">Update Brew and Packages</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Install-brew-services"><span class="nav-text">Install brew services</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安裝-DNSMasq"><span class="nav-text">安裝 DNSMasq</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#安裝-Install"><span class="nav-text">安裝  Install</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置-Configure"><span class="nav-text">配置  Configure</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#start、stop、restart-DNSMasq"><span class="nav-text">start、stop、restart DNSMasq</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#測試-Testing"><span class="nav-text">測試  Testing</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安裝-PHP-FPM"><span class="nav-text">安裝 PHP-FPM</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Install-php71"><span class="nav-text">Install php71</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置-Configure-1"><span class="nav-text">配置  Configure</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#測試-Testing-1"><span class="nav-text">測試  Testing</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安裝-NGINX"><span class="nav-text">安裝 NGINX</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Install-NGINX"><span class="nav-text">Install NGINX</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安裝測試-Testing"><span class="nav-text">安裝測試  Testing</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Stop-Nginx"><span class="nav-text">Stop Nginx</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置-Configure-2"><span class="nav-text">配置  Configure</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#建立目錄-Create-directories"><span class="nav-text">建立目錄  Create directories</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#配置檔案-nginx-conf"><span class="nav-text">配置檔案 nginx.conf</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#啟動並測試-Nginx-Start-and-Test-Nginx"><span class="nav-text">啟動並測試 Nginx  Start and Test Nginx</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#設定-SSL-Setup-SSL"><span class="nav-text">設定 SSL  Setup SSL</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#建立-Virtual-Hosts-網站檔案"><span class="nav-text">建立 Virtual Hosts 網站檔案</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Activate-Virtual-Hosts"><span class="nav-text">Activate Virtual Hosts</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#測試-Testing-2"><span class="nav-text">測試 Testing</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安裝其他-Libraries"><span class="nav-text">安裝其他 Libraries</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#後記-Epilogue"><span class="nav-text">後記 Epilogue</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#參考資料-References"><span class="nav-text">參考資料  References</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jerry Huang</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  





  






  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (search_path.endsWith("json")) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

</body>
</html>
